#[test]
fn anti_symmetry_extension() {
    assert_eq!(
        crate::curve::closed_anti_sym_ext(OPEN_CURVE),
        OPEN_CURVE_ANS
    );
}

/* Chiang, C. H. (1984). ON THE CLASSIFICATION OF SPHERICAL FOUR-BAR LINKAGES
 * (Vol. 19, Issue 3). */
#[test]
fn spherical_loop_reduce() {
    use crate::{FourBarTy::*, SNormFourBar};
    use approx::assert_abs_diff_eq;

    macro_rules! assert_fb_eq {
        ([$l0:literal, $l1:literal, $l2:literal, $l3:literal],
         [$pl0:literal, $pl1:literal, $pl2:literal, $pl3:literal],
         $ty:expr) => {
            let fb = SNormFourBar::new_degrees([$l0, $l1, $l2, $l3, 0., 0.], false);
            let [l0, l1, l2, l3] = fb.planar_loop();
            assert_abs_diff_eq!(l0.to_degrees(), $pl0, epsilon = 1e-12);
            assert_abs_diff_eq!(l1.to_degrees(), $pl1, epsilon = 1e-12);
            assert_abs_diff_eq!(l2.to_degrees(), $pl2, epsilon = 1e-12);
            assert_abs_diff_eq!(l3.to_degrees(), $pl3, epsilon = 1e-12);
            assert_eq!(fb.ty(), $ty);
        };
    }

    assert_fb_eq!([80., 20., 60., 75.], [80., 20., 60., 75.], GCRR);
    assert_fb_eq!([30., 60., 60., 75.], [30., 60., 60., 75.], GCCC);
    assert_fb_eq!([80., 75., 25., 70.], [80., 75., 25., 70.], GRCR);
    assert_fb_eq!([85., 75., 65., 70.], [85., 75., 65., 70.], RRR1);
    assert_fb_eq!([100., 160., 120., 105.], [80., 20., 60., 75.], GCRR);
    assert_fb_eq!([120., 25., 110., 100.], [60., 25., 70., 100.], GCRR);
    assert_fb_eq!([155., 60., 70., 80.], [25., 60., 70., 100.], GCCC);
    assert_fb_eq!([155., 50., 65., 80.], [25., 50., 65., 100.], RRR4);
    assert_fb_eq!([60., 80., 25., 110.], [60., 100., 25., 70.], GRCR);
    assert_fb_eq!([100., 40., 90., 60.], [80., 40., 90., 60.], GCRR);
}

const OPEN_CURVE: &[[f64; 2]] = &[
    [0.028607755880487345, 47.07692307692308],
    [6.182453909726641, 52.76923076923077],
    [14.797838525111256, 57.07692307692308],
    [24.643992371265103, 58.61538461538461],
    [41.10553083280357, 59.07692307692308],
    [50.18245390972664, 56.76923076923077],
    [60.6439923712651, 51.53846153846154],
    [65.41322314049587, 46.0],
    [68.79783852511126, 36.92307692307692],
    [67.41322314049587, 25.384615384615383],
    [60.6439923712651, 18.153846153846153],
];
const OPEN_CURVE_ANS: &[[f64; 2]] = &[
    [0.0, 0.0],
    [0.09230769230769287, 8.584615384615379],
    [2.6461538461538456, 15.784615384615385],
    [6.430769230769233, 20.21538461538461],
    [16.830769230769235, 23.56923076923077],
    [19.846153846153847, 24.15384615384615],
    [24.246153846153845, 21.815384615384616],
    [22.953846153846158, 19.16923076923077],
    [20.276923076923083, 12.984615384615381],
    [12.830769230769235, 4.338461538461537],
    [0.0, 0.0],
    [-12.830769230769235, -4.338461538461537],
    [-20.276923076923083, -12.984615384615381],
    [-22.953846153846158, -19.16923076923077],
    [-24.246153846153845, -21.815384615384616],
    [-19.846153846153847, -24.15384615384615],
    [-16.830769230769235, -23.56923076923077],
    [-6.430769230769233, -20.21538461538461],
    [-2.6461538461538456, -15.784615384615385],
    [-0.09230769230769287, -8.584615384615379],
];
